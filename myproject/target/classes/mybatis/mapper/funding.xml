<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.funding.dao.IFundingDao">
	
	<sql id="search">
		<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchCategory)">
			AND fu_cate = #{searchCategory}
		</if>
		<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchSite)">
			AND fu_site = #{searchSite}
		</if>
	</sql>
	
	<sql id="array">
		<if test="@org.apache.commons.lang3.StringUtils@isBlank(arraryType)">
		ORDER BY dbms_random.value
		</if>
		<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(arraryType)">
		ORDER BY 	${arraryType}
		</if>
	</sql>
	
	<select id="getTotalRowCount" resultType="int" parameterType="com.study.funding.vo.FundingSerchVO">
		SELECT count(*)      
		FROM funding     
		WHERE 1=1
		<include refid="search"></include>		
		<include refid="array"></include>		
	</select>
	
	<select id="getFundingList" parameterType="com.study.funding.vo.FundingVO"
	resultType="com.study.funding.vo.FundingVO">	
		<include refid="common.prePage"></include>         
		SELECT
	    fu_no	   			 , fu_site	    , fu_title
	    , fu_cate       , fu_enter	    , fu_img
	    , fu_percent	 , fu_amount	    , fu_dday
	    , fu_url  	    , fu_like
		FROM
	    funding
		WHERE 1=1
		<include refid="search"></include>		
		<include refid="array"></include>		
		<include refid="common.postPage"></include>
	</select>
	
	<select id="getfunding" resultType="com.study.funding.vo.FundingVO" parameterType="int">
	SELECT
	    fu_no	   			 , fu_site	    , fu_title
	    , fu_cate       , fu_enter	    , fu_img
	    , fu_percent	 , fu_amount	    , fu_dday
	    , fu_url  	    , fu_like
	FROM    funding
	WHERE fu_no =#{fuNo}
	</select>
	
	<update id="addLike" parameterType="int">
		UPDATE funding SET
		FU_LIKE = FU_LIKE + 1
		WHERE fu_no=#{fuNo}	
	</update>
	
	<update id="subLike" parameterType="int">
		UPDATE funding SET
		FU_LIKE = FU_LIKE - 1
		WHERE fu_no=#{fuNo}	
	</update>

</mapper>